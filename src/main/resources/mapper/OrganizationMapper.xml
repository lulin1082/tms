<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
 classpath:mapper/ProjectMapper.xml
 -->
<mapper namespace="cn.tedu.ttms.system.dao.OrganizationDao">

    <select id="findOrgObjects" resultType="Map">
           SELECT o1.id,o1.name,o1.code,o2.name AS `parentName`,o1.valid
        FROM sys_organizations o1,sys_organizations o2
        <where>
            o1.parentId = o2.id
        <if test="entity != null">
                <if test="entity.name != null and entity.name != '' ">
                    o1.name like CONCAT ("%",#{entity.name},"%")
                </if>
                <if test="entity.valid != null">
                    and o1.valid = #{entity.valid}
                </if>
                ORDER BY  o1.name
        </if></where>
        limit #{pageObject.startIndex},#{pageObject.pageSize}
        </select>

        <select id="findPageObjects" parameterType="cn.tedu.ttms.system.entity.Organization">
            SELECT * FROM sys_organizations organizations
            <if test="entity != null">
                <where>
                      <if test="entity.name != null and entity.name != '' ">
                          organizations.name like CONCAT ("%",#{entity.name},"%")
                      </if>
                    <if test="entity.valid != null">
                        and organizations.valid = #{entity.valid}
                    </if>
                     ORDER BY  organizations.name
                </where>
            </if>
            limit #{pageObject.startIndex},#{pageObject.pageSize}
        </select>

<!--  id name code parentId valid note* -->


    <insert id="insertObject" parameterType="cn.tedu.ttms.system.entity.Organization">
            INSERT  INTO sys_organizations (name,valid)VALUES (
                  entity.name,entity.valid
            )
        </insert>
    
        <update id="updateObjec" parameterType="cn.tedu.ttms.system.entity.Organization">
            UPDATE  sys_organizations SET
            name = #{entity.name} ,
            valid =#{entity.valid}
        </update>

        <select id="getRowCounts" resultType="java.lang.Integer">
            select count(*) from sys_organizations o
              <if test="entity != null" >
                  <where>
                    <if test="entity.name != null and entity.name != ' ' ">
                        o.name like CONCAT ("%",#{entity.name},"%")
                    </if>
                      <if test="entity.valid !=null">
                          o.entiy=#{entity.valid}
                      </if>
                  </where>
              </if>
        </select>

        <select id="getOrgRowsCounts" resultType="java.lang.Integer">
                   SELECT COUNT(*) from sys_organizations o1,sys_organizations o2 WHERE o1.parentId = o2.id
                   <where>
                    <if test="entity != null">
                        <if test="entity.name !=null and entiy.name != ''">
                            o1.name=#{entity.name}
                        </if>
                    </if>
                   </where>
        </select>

        <update id="doValidById">
            UPDATE sys_organizations SET valid = #{valid}
            WHERE id IN
            <foreach collection="ids" open="(" close=")" separator="," item="id">
                #{ids}
            </foreach>
        </update>

    <!--<update id="validById">
        update tms_projects
        set valid=#{valid}
        where id in
        <foreach collection="ids"
                 open="(" close=")"
                 separator="," item="item">
            #{item}
        </foreach>
    </update>-->



    <select id="findIdAndNames" resultType="map">
          SELECT  id ,name FROM sys_organizations WHERE valid =1;
    </select>

    <select id="findObjectById" resultType="cn.tedu.ttms.system.entity.Organization">
        SELECT * FROM sys_organizations WHERE id = #{id};
    </select>

    </mapper>